<?php
namespace muse; require_once __dir__."/config.php"; require_once __dir__."/basic_auth.php"; try { $a = $GLOBALS["ACCOUNT"]->is_admin? 2: 1; if($a >= 2) { $b = date("Y/m/d"); $c = uniqid(); $e = $_FILES["image_u"]["tmp_name"]; $f = $_FILES["image_u"]["name"]; if(preg_match("/\.jpeg$/i", $f)) $g = ".jpeg"; else if(preg_match("/\.png$/i", $f)) $g = ".png"; else $g = ".jpg"; @mkdir("upload/image/$b", 0755, true); move_uploaded_file( $e, "upload/image/$b/$c$g" ); echo json_encode( [ "image_url" => "upload/image/$b/$c$g" ]); } else { echo json_encode( [ "error" => "Доступ запрещён. Пройдите авторизацию." ]); } } catch(\Exception $h) { echo json_encode( [ "error"=>$h->getMessage() ]); } 